import{a as i}from"./api-BhVipoDr.js";class c extends Error{}c.prototype.name="InvalidTokenError";function u(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,r)=>{let a=r.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}function g(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return u(e)}catch{return atob(e)}}function m(t,e){if(typeof t!="string")throw new c("Invalid token specified: must be a string");e||(e={});const r=e.header===!0?0:1,a=t.split(".")[r];if(typeof a!="string")throw new c(`Invalid token specified: missing part #${r+1}`);let o;try{o=g(a)}catch(n){throw new c(`Invalid token specified: invalid base64 for part #${r+1} (${n.message})`)}try{return JSON.parse(o)}catch(n){throw new c(`Invalid token specified: invalid json for part #${r+1} (${n.message})`)}}const p={async login(t){var e,r,a;try{const o=await i.post("/auth/login",t),{access_token:n}=o.data;if(!n)throw new Error("Token não encontrado na resposta do servidor");const s=m(n),l={id:s.id||s.userId||s.sub,email:s.email||s.login||t.login,name:s.name||s.username||t.login.split("@")[0]};return localStorage.setItem("auth_token",n),localStorage.setItem("user_id",l.id),localStorage.setItem("user_email",l.email),localStorage.setItem("user_name",l.name),localStorage.setItem("user_data",JSON.stringify(l)),{token:n,user:l}}catch(o){const n=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||o.message||"Erro ao fazer login",s=new Error(n);throw(a=o.response)!=null&&a.status&&(s.status=o.response.status),s}},async logout(){localStorage.removeItem("auth_token"),localStorage.removeItem("user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_name"),localStorage.removeItem("user_data"),localStorage.removeItem("selected_client_id")},getToken(){return localStorage.getItem("auth_token")},isTokenValid(t){const e=t||this.getToken();if(!e)return!1;try{const r=e.split(".");if(r.length!==3)return!1;const a=JSON.parse(atob(r[1])),o=Date.now();return!(a.exp&&a.exp<o)}catch{return!1}},getCurrentUserId(){return localStorage.getItem("user_id")},async getCurrentUser(){const t=this.getCurrentUserId();if(!t)throw new Error("Usuário não autenticado");const e=localStorage.getItem("user_data");return e?JSON.parse(e):{id:t,email:localStorage.getItem("user_email")||"",name:localStorage.getItem("user_name")||""}},getCurrentUserFromStorage(){try{const t=this.getCurrentUserId();if(!t)return null;const e=localStorage.getItem("user_data");return e?JSON.parse(e):{id:t,email:localStorage.getItem("user_email")||"",name:localStorage.getItem("user_name")||""}}catch{return null}}};export{p as a};
