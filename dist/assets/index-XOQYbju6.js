import{c as j,j as e,i as O,p as Fe,B as v,X as ye,u as we,r as o,S as qe,q as De,s as Oe,t as ce,b as Ne,v as ke,w as U,x as Ve,L as ie,y as H,z as Be,A as He,k as W,d as Q,a as Ze,m as re,e as R}from"./index-hV2YQk7K.js";import{S as Ce,a as _e,b as Me,c as Pe,d as Y,D as Se,e as Ee,f as Ie,g as ze,h as Ke,o as Ue,i as Ae,C as Qe,j as Ge,k as We,P as Ye,l as Je,m as Xe,n as es,p as ss,q as as,r as ts,s as rs,t as ae,u as ns,v as Z,w as K,x as is,y as os,z as ls,A as ds,B as cs,E as us,F as hs,G as ms,H as $e,I as xs,J as ps}from"./styles-I2YsasEH.js";import{P as oe}from"./plus-BAdeC2eA.js";import{L as gs}from"./BaseService-D-clKh8p.js";import{L as fs}from"./loader-circle-CZWR_OwY.js";import"./check-BfzSPuf9.js";import"./arrow-left-BWaTIojA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=j("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=j("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=j("CakeSlice",[["circle",{cx:"9",cy:"7",r:"2",key:"1305pl"}],["path",{d:"M7.2 7.9 3 11v9c0 .6.4 1 1 1h16c.6 0 1-.4 1-1v-9c0-2-3-6-7-8l-3.6 2.6",key:"xle13f"}],["path",{d:"M16 13H3",key:"1wpj08"}],["path",{d:"M16 17H3",key:"3lvfcd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=j("ChefHat",[["path",{d:"M17 21a1 1 0 0 0 1-1v-5.35c0-.457.316-.844.727-1.041a4 4 0 0 0-2.134-7.589 5 5 0 0 0-9.186 0 4 4 0 0 0-2.134 7.588c.411.198.727.585.727 1.041V20a1 1 0 0 0 1 1Z",key:"1qvrer"}],["path",{d:"M6 17h12",key:"1jwigz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=j("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=j("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=j("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=j("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=j("Container",[["path",{d:"M22 7.7c0-.6-.4-1.2-.8-1.5l-6.3-3.9a1.72 1.72 0 0 0-1.7 0l-10.3 6c-.5.2-.9.8-.9 1.4v6.6c0 .5.4 1.2.8 1.5l6.3 3.9a1.72 1.72 0 0 0 1.7 0l10.3-6c.5-.3.9-1 .9-1.5Z",key:"1t2lqe"}],["path",{d:"M10 21.9V14L2.1 9.1",key:"o7czzq"}],["path",{d:"m10 14 11.9-6.9",key:"zm5e20"}],["path",{d:"M14 19.8v-8.1",key:"159ecu"}],["path",{d:"M18 17.5V9.4",key:"11uown"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=j("CookingPot",[["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M20 12v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-8",key:"u0tga0"}],["path",{d:"m4 8 16-4",key:"16g0ng"}],["path",{d:"m8.86 6.78-.45-1.81a2 2 0 0 1 1.45-2.43l1.94-.48a2 2 0 0 1 2.43 1.46l.45 1.8",key:"12cejc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=j("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=j("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=j("GlassWater",[["path",{d:"M5.116 4.104A1 1 0 0 1 6.11 3h11.78a1 1 0 0 1 .994 1.105L17.19 20.21A2 2 0 0 1 15.2 22H8.8a2 2 0 0 1-2-1.79z",key:"p55z4y"}],["path",{d:"M6 12a5 5 0 0 1 6 0 5 5 0 0 0 6 0",key:"mjntcy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=j("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=j("Milk",[["path",{d:"M8 2h8",key:"1ssgc1"}],["path",{d:"M9 2v2.789a4 4 0 0 1-.672 2.219l-.656.984A4 4 0 0 0 7 10.212V20a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-9.789a4 4 0 0 0-.672-2.219l-.656-.984A4 4 0 0 1 15 4.788V2",key:"qtp12x"}],["path",{d:"M7 15a6.472 6.472 0 0 1 5 0 6.47 6.47 0 0 0 5 0",key:"ygeh44"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=j("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=j("Refrigerator",[["path",{d:"M5 6a4 4 0 0 1 4-4h6a4 4 0 0 1 4 4v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6Z",key:"fpq118"}],["path",{d:"M5 10h14",key:"elsbfy"}],["path",{d:"M15 7v6",key:"1nx30x"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=j("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=j("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=j("Soup",[["path",{d:"M12 21a9 9 0 0 0 9-9H3a9 9 0 0 0 9 9Z",key:"4rw317"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M19.5 12 22 6",key:"shfsr5"}],["path",{d:"M16.25 3c.27.1.8.53.75 1.36-.06.83-.93 1.2-1 2.02-.05.78.34 1.24.73 1.62",key:"rpc6vp"}],["path",{d:"M11.25 3c.27.1.8.53.74 1.36-.05.83-.93 1.2-.98 2.02-.06.78.33 1.24.72 1.62",key:"1lf63m"}],["path",{d:"M6.25 3c.27.1.8.53.75 1.36-.06.83-.93 1.2-1 2.02-.05.78.34 1.24.74 1.62",key:"97tijn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=j("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=j("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=j("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=j("Wheat",[["path",{d:"M2 22 16 8",key:"60hf96"}],["path",{d:"M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1rdhi6"}],["path",{d:"M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"1sdzmb"}],["path",{d:"M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z",key:"eoatbi"}],["path",{d:"M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z",key:"19rau1"}],["path",{d:"M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"tc8ph9"}],["path",{d:"M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"2m8kc5"}],["path",{d:"M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z",key:"vex3ng"}]]),As=Fe("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function de({className:s,variant:a,...l}){return e.jsx("div",{className:O(As({variant:a}),s),...l})}const $s=({onClose:s,itemCount:a})=>e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border/20",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Carrinho"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a," ",a===1?"item":"itens"]})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8",children:e.jsx(ye,{className:"h-4 w-4"})})]}),Rs=({item:s,onRemove:a,onUpdateQuantity:l,product:i})=>{const r=h=>{if(h<=0){a(s.id);return}l(s.id,h)};return e.jsx("div",{className:"border-b border-border/10 py-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:s.image,alt:s.name,className:"w-20 h-20 rounded-lg object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-sm leading-tight",children:s.name}),s.size&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Tamanho: ",s.size]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"font-bold text-lg text-primary whitespace-nowrap",children:["R$ ",(s.price*s.quantity).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-muted-foreground whitespace-nowrap",children:["R$ ",s.price.toFixed(2)," cada"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>r(s.quantity-1),children:e.jsx(le,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-12 text-center font-medium",children:s.quantity}),e.jsx(v,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>r(s.quantity+1),children:e.jsx(oe,{className:"h-3 w-3"})})]}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>a(s.id),children:e.jsx(Le,{className:"h-4 w-4"})})]})]})]})})},Ls=({totalPrice:s,items:a,allProducts:l,companyId:i,onClearCart:r,paymentType:h,onPaymentTypeChange:p,isPricingLoading:m=!1,pricingError:I=null})=>{const{toast:g}=we(),[_,E]=o.useState(!1),[k,C]=o.useState(!1),T=z=>{switch(z){case"avista":return"avista";case"dias30":return"30_dias";case"dias90":return"60_dias";default:return"avista"}},P=async()=>{if(a.length===0){g({title:"Carrinho vazio",description:"Adicione produtos ao carrinho antes de finalizar o pedido.",variant:"destructive"});return}if(!i||i===0){g({title:"Erro de configuração",description:"Não foi possível identificar a empresa. Por favor, faça login novamente.",variant:"destructive"});return}C(!0);try{const z=a.map(t=>{const y=l.find(L=>L.id_produto===t.productId);return{id_produto:t.productId,codigo:(y==null?void 0:y.codigo)||"",nome:t.name,quantidade_pedida:t.quantity,valor_unitario:t.price,valor_total:t.price*t.quantity,categoria:y==null?void 0:y.categoria,subcategoria:y==null?void 0:y.subcategoria}}),u={company_id:i,forma_pagamento:T(h),itens:z},d=await Ue.sendOrderEmail(u);E(!0),g({title:"Pedido enviado com sucesso!",description:`Email enviado para ${d.email_enviado}`})}catch(z){console.error("Erro ao enviar pedido:",z),g({title:"Erro ao enviar pedido",description:z.message||"Ocorreu um erro ao enviar o pedido. Tente novamente.",variant:"destructive"})}finally{C(!1)}},F=()=>{E(!1),r()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-border/20 pt-4 pb-4 space-y-4 bg-background",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["Total: R$ ",s.toFixed(2)]}),I&&e.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:I})]}),e.jsx(qe,{}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(gs,{htmlFor:"paymentType",className:"text-sm font-medium whitespace-nowrap",children:"Forma de Pagamento:"}),e.jsxs(Ce,{value:h,onValueChange:p,disabled:k||m,children:[e.jsx(_e,{className:"w-40 bg-background",children:e.jsx(Me,{})}),e.jsxs(Pe,{className:"bg-background z-50",children:[e.jsx(Y,{value:"avista",children:"À vista"}),e.jsx(Y,{value:"dias30",children:"30 dias"}),e.jsx(Y,{value:"dias90",children:"60 dias"})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(v,{onClick:P,className:"flex-1 h-12 text-base font-semibold",size:"lg",disabled:k||m||a.length===0,children:k?e.jsxs(e.Fragment,{children:[e.jsx(fs,{className:"h-5 w-5 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-5 w-5 mr-2"}),m?"Calculando preços...":"Realizar Pedido"]})}),e.jsx(v,{variant:"outline",onClick:r,className:"h-12 w-12 p-0",size:"icon",disabled:k,children:e.jsx(Le,{className:"h-5 w-5"})})]})]}),e.jsx(Se,{open:_,onOpenChange:F,children:e.jsxs(Ee,{className:"bg-background",children:[e.jsxs(Ie,{children:[e.jsx(ze,{className:"text-2xl",children:"Pedido Enviado com Sucesso!"}),e.jsx(Ke,{className:"text-base pt-2",children:"Seu pedido foi enviado por email. Em breve entraremos em contato com você."})]}),e.jsx(v,{onClick:F,className:"h-12 text-base font-semibold",children:"Fechar"})]})})]})},Ts=({isOpen:s,onClose:a,items:l,onRemoveItem:i,onUpdateQuantity:r,getTotalPrice:h,companyId:p,onClearCart:m,paymentType:I,onPaymentTypeChange:g,isPricingLoading:_=!1,pricingError:E=null,allProducts:k=[]})=>(we(),e.jsx(De,{open:s,onOpenChange:a,children:e.jsxs(Oe,{className:"w-full sm:max-w-lg flex flex-col [&>button]:hidden",children:[e.jsx($s,{onClose:a,itemCount:l.length}),e.jsx("div",{className:"flex flex-col flex-1 overflow-hidden",children:l.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center py-12",children:[e.jsx(J,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Carrinho vazio"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Adicione alguns produtos para começar"}),e.jsx(v,{onClick:a,children:"Continuar comprando"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"flex-1 -mx-6 px-6",children:e.jsx("div",{className:"space-y-4 py-4",children:l.map(C=>{const T=k.find(P=>P.id_produto===C.productId);return e.jsx(Rs,{item:C,product:T,onRemove:i,onUpdateQuantity:r},C.id)})})}),e.jsx("div",{className:"mt-auto -mx-6 px-6",children:e.jsx(Ls,{totalPrice:h,items:l,allProducts:k,companyId:p,onClearCart:m,paymentType:I,onPaymentTypeChange:g,isPricingLoading:_,pricingError:E})})]})})]})}));function ue(s){if(!s)return s;if(s.includes("drive.google.com")){const a=s.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);if(a&&a[1])return`https://drive.google.com/uc?export=view&id=${a[1]}`}return s}const Fs=({product:s,isOpen:a,onClose:l,priceType:i,onAddToCart:r})=>{const[h,p]=o.useState(1),[m,I]=o.useState(),[g,_]=o.useState(0),[E,k]=o.useState(0),[C,T]=o.useState(()=>{var d;const u={};return(d=s.kits)==null||d.forEach(t=>{u[t.id_produto]=1}),u}),P=s.imagens&&s.imagens.length>0?s.imagens.map(u=>ue(u)):["https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400&h=400&fit=crop"];o.useEffect(()=>{m&&(k(m.scrollSnapList().length),_(m.selectedScrollSnap()+1),m.on("select",()=>{_(m.selectedScrollSnap()+1)}))},[m]),o.useEffect(()=>{a&&m&&P.length>1&&(m.scrollTo(0),_(1))},[a,s.id_produto,m,P.length]);const F=(u,d)=>{r==null||r(u,"",i,d)},z=(u,d)=>{T(t=>({...t,[u]:Math.max(1,(t[u]||1)+d)}))};return e.jsx(Se,{open:a,onOpenChange:l,children:e.jsxs(Ee,{className:"max-w-6xl max-h-[95vh] overflow-y-auto glass border-0",children:[e.jsx(Ie,{children:e.jsx(ze,{className:"text-2xl font-bold text-primary text-center",children:s.nome})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[P.length>1?e.jsxs("div",{className:"relative w-full aspect-square bg-white rounded-lg overflow-hidden border border-border/20",children:[e.jsxs(Qe,{setApi:I,className:"w-full h-full",opts:{align:"start",loop:!1,dragFree:!1},children:[e.jsx(Ge,{className:"h-full -ml-0",children:P.map((u,d)=>e.jsx(We,{className:"pl-0 h-full basis-full",children:e.jsx("div",{className:"w-full h-full relative flex items-center justify-center",children:e.jsx("img",{src:u,alt:`${s.nome} - Imagem ${d+1}`,className:"w-full h-full object-contain",draggable:!1})})},d))}),E>1&&e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-black/30 hover:bg-black/50 text-white z-10 backdrop-blur-sm",onClick:()=>m==null?void 0:m.scrollPrev(),disabled:g===1,children:e.jsx(ws,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 rounded-full bg-black/30 hover:bg-black/50 text-white z-10 backdrop-blur-sm",onClick:()=>m==null?void 0:m.scrollNext(),disabled:g===E,children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),E>1&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10 px-2 py-1.5 rounded-full bg-black/30 backdrop-blur-sm",children:P.map((u,d)=>e.jsx("button",{className:`rounded-full transition-all duration-300 ${d+1===g?"w-2 h-2 bg-white":"w-1.5 h-1.5 bg-white/60 hover:bg-white/80"}`,onClick:()=>m==null?void 0:m.scrollTo(d),"aria-label":`Ir para imagem ${d+1}`},d))})]}):e.jsx("div",{className:"w-full aspect-square bg-white rounded-lg overflow-hidden border border-border/20",children:e.jsx("img",{src:P[0],alt:s.nome,className:"w-full h-full object-contain"})}),s.kits&&s.kits.length>0&&e.jsxs(de,{className:"w-fit bg-primary text-primary-foreground",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),s.kits.length," Kit",s.kits.length>1?"s":""," disponível",s.kits.length>1?"eis":""]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Informações do Produto"}),s.descricao&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.descricao})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[(s.avista!==void 0||s["30_dias"]!==void 0||s["60_dias"]!==void 0)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-2",children:"Preços"}),e.jsx("div",{className:"bg-muted/30 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.avista!==void 0&&e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"À vista"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["R$ ",s.avista.toFixed(2)]})]}),s["30_dias"]!==void 0&&e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"30 dias"}),e.jsxs("div",{className:"text-2xl font-semibold",children:["R$ ",s["30_dias"].toFixed(2)]})]}),s["60_dias"]!==void 0&&e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"60 dias"}),e.jsxs("div",{className:"text-2xl font-semibold",children:["R$ ",s["60_dias"].toFixed(2)]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-2",children:"Compra Unitária"}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4",children:[e.jsx(v,{variant:"outline",size:"icon",className:"h-10 w-10",onClick:()=>p(Math.max(1,h-1)),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-16 text-center text-2xl font-medium",children:h}),e.jsx(v,{variant:"outline",size:"icon",className:"h-10 w-10",onClick:()=>p(h+1),children:e.jsx(oe,{className:"h-4 w-4"})})]}),r&&e.jsxs(v,{onClick:()=>r(s,"",i,h),className:"w-full gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(J,{className:"h-4 w-4"}),"Adicionar ao Carrinho"]})]})]}),s.kits&&s.kits.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold border-b pb-2",children:"Kits Disponíveis"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.kits.map(u=>e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 border border-border/20",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(de,{className:"bg-blue-600 text-white",children:[u.quantidade||1," Unidades"]}),u.codigo&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Cód: ",u.codigo]})]}),u.descricao&&e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:u.descricao}),e.jsxs("div",{className:"space-y-1 mb-3",children:[u.avista!==void 0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"À vista:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["R$ ",u.avista.toFixed(2)]})]}),u["30_dias"]!==void 0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"30 dias:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",u["30_dias"].toFixed(2)]})]}),u["60_dias"]!==void 0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"60 dias:"}),e.jsxs("span",{className:"font-semibold",children:["R$ ",u["60_dias"].toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx(v,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>z(u.id_produto,-1),children:e.jsx(le,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center text-sm font-medium",children:C[u.id_produto]||1}),e.jsx(v,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>z(u.id_produto,1),children:e.jsx(oe,{className:"h-3 w-3"})})]}),r&&e.jsxs(v,{variant:"outline",size:"sm",className:"w-full gap-2",onClick:()=>F(u,C[u.id_produto]||1),children:[e.jsx(J,{className:"h-3 w-3"}),"Adicionar Kit"]})]},u.id_produto))})]})]})]})]})})},qs=({product:s,priceType:a,onAddToCart:l})=>{const[i,r]=o.useState(!1),h=()=>s.imagens&&s.imagens.length>0?ue(s.imagens[0]):"https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=300&h=200&fit=crop";return e.jsxs(e.Fragment,{children:[e.jsxs(Ye,{onClick:()=>r(!0),children:[e.jsxs(Je,{children:[e.jsx(Xe,{src:h(),alt:s.nome}),s.kits&&s.kits.length>0&&e.jsxs(es,{children:[e.jsx(ce,{className:"h-3 w-3"}),"Kit"]})]}),e.jsxs(ss,{children:[e.jsxs("div",{children:[s.categoria&&e.jsx(as,{children:s.categoria}),e.jsx(ts,{children:s.nome||"Produto sem nome"})]}),(s.avista!==void 0||s["30_dias"]!==void 0||s["60_dias"]!==void 0)&&e.jsxs(rs,{children:[e.jsx(ae,{children:"Preços:"}),e.jsxs(ns,{children:[s.avista!==void 0&&e.jsxs(Z,{children:[e.jsx(ae,{children:"À vista:"}),e.jsxs(K,{isHighlight:!0,children:["R$ ",s.avista.toFixed(2)]})]}),s["30_dias"]!==void 0&&e.jsxs(Z,{children:[e.jsx(ae,{children:"30 dias:"}),e.jsxs(K,{children:["R$ ",s["30_dias"].toFixed(2)]})]}),s["60_dias"]!==void 0&&e.jsxs(Z,{children:[e.jsx(ae,{children:"60 dias:"}),e.jsxs(K,{children:["R$ ",s["60_dias"].toFixed(2)]})]})]})]}),s.kits&&s.kits.length>0&&(()=>{const p=s.kits[0];return e.jsxs(is,{children:[e.jsxs(os,{children:["Kit (",p.quantidade||1," un):"]}),e.jsxs(ls,{children:[p.avista!==void 0&&e.jsx(Z,{children:e.jsxs(K,{isHighlight:!0,children:["R$ ",p.avista.toFixed(2)]})}),p["30_dias"]!==void 0&&e.jsx(Z,{children:e.jsxs(K,{children:["R$ ",p["30_dias"].toFixed(2)]})}),p["60_dias"]!==void 0&&e.jsx(Z,{children:e.jsxs(K,{children:["R$ ",p["60_dias"].toFixed(2)]})})]}),e.jsxs(ds,{children:[s.kits.length," opções de kit disponíveis"]})]})})()]})]}),e.jsx(Fs,{product:s,isOpen:i,onClose:()=>r(!1),priceType:a,onAddToCart:l})]})},Ds=({categories:s,selectedCategory:a,selectedSubcategory:l,isLoadingCategories:i=!1,onCategorySelect:r,onSubcategorySelect:h})=>{const[p,m]=o.useState(new Set),[I,g]=o.useState(!1),{isAdmin:_,isLoading:E}=Ne(),k=ke(),C=d=>k.pathname===d,T=!E&&_,P=d=>{const t=d.toLowerCase();return t.includes("pressão")||t.includes("pressao")?Ns:t.includes("caldeirão")||t.includes("caldeirao")||t.includes("caldeiroes")?be:t.includes("jarra")?pe:t.includes("marmita")?ge:t.includes("concha")?be:t.includes("filtra")||t.includes("óleo")||t.includes("oleo")?Cs:t.includes("feirinha")||t.includes("kit")?Es:t.includes("bacia")||t.includes("balde")?ge:t.includes("depósito")||t.includes("deposito")||t.includes("alimento")?bs:t.includes("pipoqueira")?Is:t.includes("latão")||t.includes("latao")||t.includes("leite")?Ps:t.includes("espagueteira")||t.includes("macarrão")||t.includes("macarrao")?zs:t.includes("moringa")?ks:t.includes("wok")?ve:t.includes("cuscuzeira")?ys:t.includes("blue")?Ss:t.includes("copo")?_s:t.includes("panela")||t.includes("caçarola")||t.includes("cacarola")?fe:t.includes("frigideira")?ve:t.includes("forma")||t.includes("assadeira")?js:t.includes("canecão")||t.includes("canecao")||t.includes("fervedor")?pe:fe},F=d=>{const t=String(d),y=new Set(p);y.has(t)&&a!==d?y.delete(t):y.add(t),m(y)};o.useEffect(()=>{a!=null&&m(d=>{const t=new Set(d);return t.add(String(a)),t})},[a]);const z=(d,t)=>{a!==d&&(r(d),h(null),m(y=>{const L=new Set(y);return L.add(String(d)),L})),h(l===t?null:t),g(!1)},u=e.jsxs("div",{className:"h-full flex flex-col",style:{background:"var(--gradient-sidebar)"},children:[e.jsx("div",{className:"p-6 border-b border-sidebar-border",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-sidebar-primary mb-2",children:"FORTLAR"}),e.jsx("p",{className:"text-sidebar-foreground/80 text-sm",children:"Utensílios de Qualidade"})]})}),e.jsxs(Ae,{className:"flex-1 p-4",children:[e.jsxs("div",{className:"space-y-2",children:[!i&&e.jsx(v,{variant:a===null?"default":"ghost",className:O("w-full justify-start text-left h-auto p-3 text-sidebar-foreground hover:bg-sidebar-accent/20",a===null&&"bg-sidebar-primary hover:bg-sidebar-primary/80 text-sidebar-primary-foreground"),onClick:()=>{r(null),h(null),g(!1)},children:"Todos os Produtos"}),i&&s.length===0&&e.jsx("div",{className:"space-y-2",children:Array.from({length:8}).map((d,t)=>e.jsx("div",{className:"w-full rounded-lg p-3 bg-sidebar-accent/10",children:e.jsx(U,{className:"h-4 w-3/4 bg-white/20"})},t))}),!i&&s.map(d=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs(v,{variant:"ghost",className:O("w-full justify-between text-left h-auto p-3 text-sidebar-foreground hover:bg-sidebar-accent/20",a===d.id_categoria&&"bg-sidebar-primary hover:bg-sidebar-primary/80 text-sidebar-primary-foreground"),onClick:()=>{r(d.id_categoria),h(null),F(d.id_categoria),g(!1)},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const t=P(d.nome);return e.jsx(t,{className:"h-4 w-4"})})(),e.jsx("span",{className:"font-medium",children:d.nome})]}),p.has(String(d.id_categoria))?e.jsx(cs,{className:"h-4 w-4"}):e.jsx(Re,{className:"h-4 w-4"})]}),p.has(String(d.id_categoria))&&e.jsx("div",{className:"ml-4 space-y-1 animate-fade-in",children:d.subcategorias.map(t=>e.jsx(v,{variant:"ghost",size:"sm",className:O("w-full justify-start text-left h-auto p-2 pl-4 text-sidebar-foreground/70 hover:bg-sidebar-accent/20",l===t.id_subcategoria&&"bg-sidebar-primary text-sidebar-primary-foreground hover:bg-sidebar-primary/80"),onClick:()=>z(d.id_categoria,t.id_subcategoria),children:t.nome},t.id_subcategoria))})]},d.id_categoria))]}),T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-sidebar-border"}),e.jsxs("div",{className:"px-2 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-2",children:[e.jsx(Ve,{className:"h-4 w-4 text-sidebar-primary"}),e.jsx("span",{className:"text-sm font-semibold text-sidebar-foreground",children:"Administração"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ie,{to:H.admin.produtos,children:e.jsxs(v,{variant:"ghost",className:O("w-full justify-start text-left h-auto p-3 text-sidebar-foreground hover:bg-sidebar-accent/20",C(H.admin.produtos)&&"bg-sidebar-primary hover:bg-sidebar-primary/80 text-sidebar-primary-foreground"),onClick:()=>g(!1),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-medium",children:"Produtos"})]})}),e.jsx(ie,{to:H.admin.descontos,children:e.jsxs(v,{variant:"ghost",className:O("w-full justify-start text-left h-auto p-3 text-sidebar-foreground hover:bg-sidebar-accent/20",C(H.admin.descontos)&&"bg-sidebar-primary hover:bg-sidebar-primary/80 text-sidebar-primary-foreground"),onClick:()=>g(!1),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-medium",children:"Descontos por Região"})]})}),e.jsx(ie,{to:H.admin.cupons,children:e.jsxs(v,{variant:"ghost",className:O("w-full justify-start text-left h-auto p-3 text-sidebar-foreground hover:bg-sidebar-accent/20",C(H.admin.cupons)&&"bg-sidebar-primary hover:bg-sidebar-primary/80 text-sidebar-primary-foreground"),onClick:()=>g(!1),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"font-medium",children:"Cupons"})]})})]})]})]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:e.jsx(v,{variant:"default",size:"icon",onClick:()=>g(!0),className:"bg-primary hover:bg-primary/80 text-primary-foreground shadow-lg",children:e.jsx(Ms,{className:"h-4 w-4"})})}),e.jsx("div",{className:"hidden lg:block fixed left-0 top-0 h-full w-80 shadow-xl z-40",children:u}),I&&e.jsxs("div",{className:"lg:hidden fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>g(!1)}),e.jsxs("div",{className:"absolute left-0 top-0 h-full w-80 max-w-[85vw] shadow-xl animate-slide-in",children:[e.jsx("div",{className:"absolute right-4 top-4 z-10",children:e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>g(!1),className:"text-sidebar-foreground hover:bg-sidebar-accent/20",children:e.jsx(ye,{className:"h-4 w-4"})})}),u]})]})]})},Os=({sortBy:s,onSortChange:a,productCount:l,isUpdating:i=!1})=>e.jsx("div",{className:"bg-card border border-border rounded-lg p-4 shadow-soft",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Ordenar por Preço"}),l>0&&e.jsxs(de,{variant:"secondary",className:"ml-2",children:[l," produto",l!==1?"s":""]}),i&&e.jsxs("span",{className:"ml-2 inline-flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"h-3 w-3 border-2 border-primary border-t-transparent rounded-full animate-spin"}),"Atualizando..."]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(Ce,{value:s,onValueChange:a,children:[e.jsx(_e,{className:"w-44",children:e.jsx(Me,{})}),e.jsxs(Pe,{children:[e.jsx(Y,{value:"price-high",children:"Maior preço"}),e.jsx(Y,{value:"price-low",children:"Menor preço"})]})]})})]})}),Te={async getProducts(s,a){var l,i;try{const r={},h=(s==null?void 0:s.categoria)??(s==null?void 0:s.id_category),p=(s==null?void 0:s.subcategoria)??(s==null?void 0:s.id_subcategory);return h!=null&&(r.categoria=h,r.id_category=h),p!=null&&(r.subcategoria=p,r.id_subcategory=p),s!=null&&s.order_price&&(r.order_price=s.order_price),(s==null?void 0:s.limit)!==void 0&&(s==null?void 0:s.limit)!==null&&(r.limit=s.limit),s!=null&&s.user_estate&&(r.estado=s.user_estate),(await W.get("/product",{params:r,signal:a==null?void 0:a.signal})).data}catch(r){throw r.response?r:new Error(((i=(l=r.response)==null?void 0:l.data)==null?void 0:i.message)||"Erro ao buscar produtos")}},async getProductById(s){var a,l;try{return(await W.get(`/product/${s}`)).data}catch(i){throw i.response?i:new Error(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||"Erro ao buscar produto")}},async uploadProducts(s){var a,l,i,r;try{const h=["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],p=[".csv",".xls",".xlsx"],m=s.name.toLowerCase().substring(s.name.lastIndexOf("."));if(!(h.includes(s.type)||p.includes(m)))throw new Error("Tipo de arquivo inválido. Apenas arquivos CSV ou Excel (.csv, .xls, .xlsx) são permitidos.");const g=new FormData;return g.append("file",s),(await W.post("/product",g)).data}catch(h){if(h.response){const p=((l=(a=h.response)==null?void 0:a.data)==null?void 0:l.message)||((r=(i=h.response)==null?void 0:i.data)==null?void 0:r.error)||"Erro ao fazer upload do arquivo";throw new Error(p)}throw h}},async getCartPrices(s,a){const l=new URLSearchParams;return l.set("estado",s.estado),l.set("prazo",String(s.prazo)),s.ids.forEach(r=>l.append("ids",String(r))),(await W.get(`/product/cart/prices?${l.toString()}`,{signal:a==null?void 0:a.signal})).data}},Vs=()=>{const[s,a]=o.useState([]),[l,i]=o.useState(!1),[r,h]=o.useState("avista"),[p,m]=o.useState(!1),[I,g]=o.useState(null),_=o.useCallback((n,c)=>c==="avista"?n.avista??n.valor_base??0:c==="dias30"?n["30_dias"]??n.valor_base??0:c==="dias90"?n["60_dias"]??n.valor_base??0:n.avista??n.valor_base??0,[]),E=o.useCallback((n,c,x,w=1)=>{if(!n||!n.id_produto||!n.nome){console.error("Invalid product:",n);return}a(A=>{const N=A.findIndex(S=>S.productId===n.id_produto&&S.size===c&&S.name===n.nome);if(N>=0)return A.map((S,D)=>D===N?{...S,quantity:S.quantity+w}:S);{const S={id:`${n.id_produto}-${c}-${Date.now()}`,productId:n.id_produto,name:n.nome||"Produto sem nome",image:n.imagens&&n.imagens.length>0?ue(n.imagens[0]):"https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=64&h=64&fit=crop",size:c,priceType:r,price:_(n,r),quantity:w};return[...A,S]}}),i(!0)},[_,r]),k=o.useCallback(n=>{a(c=>c.filter(x=>x.id!==n))},[]),C=o.useCallback((n,c)=>{if(c<=0){k(n);return}a(x=>x.map(w=>w.id===n?{...w,quantity:c}:w))},[k]),T=o.useCallback((n,c,x)=>{if(!x){console.error("Invalid product for updatePriceType:",x);return}a(w=>w.map(A=>A.id===n?{...A,priceType:c,price:_(x,c)}:A))},[_]),P=o.useCallback(n=>{h(n),a(c=>c.map(x=>({...x,priceType:n})))},[]),F=o.useCallback(n=>{switch(n){case"avista":return 0;case"dias30":return 30;case"dias90":return 60;default:return 0}},[]),z=o.useMemo(()=>Array.from(new Set(s.map(c=>c.productId))).sort((c,x)=>c-x).join(","),[s]),u=o.useRef(null);o.useEffect(()=>{var A;const n=Array.from(new Set(s.map(N=>N.productId)));if(n.length===0){g(null),m(!1);return}const c=Q.getUserEstate();if(!c){g("Não foi possível calcular preços: estado do usuário não encontrado.");return}const x=F(r);(A=u.current)==null||A.abort();const w=new AbortController;return u.current=w,m(!0),g(null),Te.getCartPrices({estado:c,prazo:x,ids:n},{signal:w.signal}).then(N=>{var G,X;const S=new Map,D=(G=N.items)==null?void 0:G.some(q=>!q.found||q.preco==null);(X=N.items)==null||X.forEach(q=>{q.found&&q.preco!=null&&S.set(q.id_produto,q.preco)}),a(q=>q.map(V=>{const ee=S.get(V.productId);return{...V,priceType:r,price:ee??V.price}})),D&&g("Alguns produtos não puderam ter o preço calculado no momento.")}).catch(N=>{(N==null?void 0:N.name)==="CanceledError"||(N==null?void 0:N.code)==="ERR_CANCELED"||g((N==null?void 0:N.message)||"Erro ao calcular preços do carrinho.")}).finally(()=>{w.signal.aborted||m(!1)}),()=>w.abort()},[z,r,F]);const d=o.useMemo(()=>s.reduce((n,c)=>n+c.price*c.quantity,0),[s]),t=o.useMemo(()=>s.reduce((n,c)=>n+c.quantity,0),[s]),y=o.useCallback(()=>{a([])},[]),L=o.useCallback(n=>{const c=d;let x=`*PEDIDO DE ORÇAMENTO*

`;return x+=`*Cliente:* ${n.name}
`,x+=`*CNPJ:* ${n.cnpj}
`,x+=`*WhatsApp:* ${n.whatsapp}
`,x+=`*Email:* ${n.email}

`,x+=`*PRODUTOS:*
`,s.forEach((w,A)=>{x+=`${A+1}. ${w.name}
`,x+=`   Tamanho: ${w.size}
`,x+=`   Quantidade: ${w.quantity}
`,x+=`   Preço unitário: R$ ${w.price.toFixed(2)}
`,x+=`   Subtotal: R$ ${(w.price*w.quantity).toFixed(2)}

`}),x+=`*TOTAL GERAL: R$ ${c.toFixed(2)}*
`,x+=`*Forma de pagamento: ${n.paymentType==="avista"?"À vista":n.paymentType==="dias30"?"30 dias":"90 dias"}*`,encodeURIComponent(x)},[s,d]);return{items:s,isDrawerOpen:l,setIsDrawerOpen:i,paymentType:r,setPaymentType:P,isPricingLoading:p,pricingError:I,addToCart:E,removeFromCart:k,updateQuantity:C,updatePriceType:T,updateAllItemsPriceType:P,getTotalPrice:d,getItemCount:t,clearCart:y,generateWhatsAppMessage:L}},Bs={async getCategories(s,a){var l,i;try{const r={};return s!=null&&s.id_category&&(r.id_category=s.id_category),s!=null&&s.id_subcategory&&(r.id_subcategory=s.id_subcategory),(await W.get("/category",{params:r,signal:a==null?void 0:a.signal})).data}catch(r){throw r.response?r:new Error(((i=(l=r.response)==null?void 0:l.data)==null?void 0:i.message)||"Erro ao buscar categorias")}}},Hs=({products:s,priceType:a,onAddToCart:l})=>e.jsx($e,{children:s.map(i=>e.jsx(qs,{product:i,priceType:a,onAddToCart:l},i.id_produto))}),Zs=({products:s,categories:a,companyId:l})=>{const{items:i,addToCart:r,removeFromCart:h,updateQuantity:p,paymentType:m,setPaymentType:I,isPricingLoading:g,pricingError:_,getTotalPrice:E,getItemCount:k,clearCart:C,isDrawerOpen:T,setIsDrawerOpen:P}=Vs(),[F,z]=o.useState(a??[]),[u,d]=o.useState(!0),[t,y]=o.useState(null),L=o.useRef(!1),n=o.useRef(!1),[c,x]=o.useState(()=>{var b;return{categoriaId:((b=a==null?void 0:a[0])==null?void 0:b.id_categoria)??null,subcategoriaId:null,sortBy:"price-low",priceType:"avista"}}),[w,A]=o.useState(s??[]),[N,S]=o.useState(!0),[D,G]=o.useState(null),[X,q]=o.useState(()=>{const b=new Map;return(s??[]).forEach(M=>b.set(M.id_produto,M)),b});o.useEffect(()=>{a!=null&&a.length&&(z(a),d(!1),y(null),L.current||x(b=>({...b,categoriaId:a[0].id_categoria,subcategoriaId:null})))},[a]);const V=o.useRef(null);o.useEffect(()=>{var M;if(a!=null&&a.length)return;(M=V.current)==null||M.abort();const b=new AbortController;return V.current=b,d(!0),y(null),S(!0),Bs.getCategories(void 0,{signal:b.signal}).then(f=>{z(f),f!=null&&f.length?L.current||x(B=>({...B,categoriaId:f[0].id_categoria,subcategoriaId:null})):(y("Nenhuma categoria disponível no momento."),S(!1))}).catch(f=>{(f==null?void 0:f.name)==="CanceledError"||(f==null?void 0:f.code)==="ERR_CANCELED"||(y((f==null?void 0:f.message)||"Não foi possível carregar as categorias."),S(!1))}).finally(()=>{b.signal.aborted||d(!1)}),()=>b.abort()},[a]);const ee=o.useRef(null);o.useEffect(()=>{var B;const b=c.categoriaId===null;if(!L.current&&b)return;const M=Q.getUserEstate();(B=ee.current)==null||B.abort();const f=new AbortController;return ee.current=f,S(!0),G(null),Te.getProducts(b?{user_estate:M}:{user_estate:M,categoria:c.categoriaId??void 0,subcategoria:c.subcategoriaId??void 0},{signal:f.signal}).then($=>{n.current=!0,A($),q(se=>{const me=new Map(se);return $.forEach(xe=>me.set(xe.id_produto,xe)),me})}).catch($=>{($==null?void 0:$.name)==="CanceledError"||($==null?void 0:$.code)==="ERR_CANCELED"||(G(($==null?void 0:$.message)||"Não foi possível carregar os produtos agora."),(!n.current||b)&&A([]))}).finally(()=>{f.signal.aborted||S(!1)}),()=>{f.abort()}},[c.categoriaId,c.subcategoriaId]);const ne=o.useMemo(()=>{const b=(w??[]).filter(f=>f!=null),M=f=>c.priceType==="avista"?f.avista??f.valor_base??0:c.priceType==="dias30"?f["30_dias"]??f.valor_base??0:f["60_dias"]??f.valor_base??0;return[...b].sort((f,B)=>{const $=M(f),se=M(B);return c.sortBy==="price-high"?se-$:$-se})},[w,c.priceType,c.sortBy]);return e.jsxs(us,{children:[e.jsx(Ds,{categories:F,selectedCategory:c.categoriaId,selectedSubcategory:c.subcategoriaId,isLoadingCategories:u,onCategorySelect:b=>{L.current=!0,x(M=>({...M,categoriaId:b,subcategoriaId:null}))},onSubcategorySelect:b=>{L.current=!0,x(M=>({...M,subcategoriaId:b}))}}),e.jsxs(hs,{children:[e.jsx(ms,{children:e.jsx(Os,{sortBy:c.sortBy,onSortChange:b=>x(M=>({...M,sortBy:b})),productCount:ne.length,isUpdating:N&&n.current&&c.categoriaId!==null})}),t&&e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:t}),!t&&N&&(!n.current||c.categoriaId===null)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-10 text-center",children:[e.jsx("div",{className:"mx-auto w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("div",{className:"mt-6 text-lg font-semibold text-foreground",children:"Estamos preparando os produtos para você"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Aguarde um instante enquanto carregamos a melhor experiência para sua navegação."})]}),e.jsx($e,{children:Array.from({length:12}).map((b,M)=>e.jsxs("div",{className:"rounded-xl overflow-hidden border bg-background/40",children:[e.jsx(U,{className:"h-48 w-full rounded-none"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx(U,{className:"h-4 w-24"}),e.jsx(U,{className:"h-5 w-3/4"}),e.jsx(U,{className:"h-4 w-2/3"}),e.jsx(U,{className:"h-4 w-1/2"})]})]},M))})]}),!t&&!N&&D&&e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:D}),!t&&!N&&!D&&ne.length===0&&e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"Nenhum produto encontrado para esta categoria."}),!t&&(!N||n.current&&c.categoriaId!==null)&&!D&&e.jsx(Hs,{products:ne,priceType:c.priceType,onAddToCart:r})]}),e.jsxs(xs,{onClick:()=>P(!0),children:[e.jsx(J,{className:"h-6 w-6"}),k>0&&e.jsx(ps,{children:k})]}),e.jsx(Ts,{isOpen:T,onClose:()=>P(!1),items:i,onRemoveItem:h,onUpdateQuantity:p,paymentType:m,onPaymentTypeChange:I,isPricingLoading:g,pricingError:_,allProducts:Array.from(X.values()),getTotalPrice:E,companyId:l||0,onClearCart:C})]})},Ks=(s={})=>{const{redirectTo:a="/login",requireAuth:l=!0}=s,i=Ze(),r=ke(),[h,p]=o.useState(!1),[m,I]=o.useState(!0),[g,_]=o.useState(null),E=async()=>{try{if(!Q.getToken())return l&&i(a,{state:{from:r.pathname},replace:!0}),!1;const C=Q.getCurrentUserFromStorage();return C?(_(C),p(!0),!0):(l&&(await Q.logout(),i(a,{state:{from:r.pathname},replace:!0})),!1)}catch(k){return console.error("Auth check error:",k),l&&(await Q.logout(),i(a,{state:{from:r.pathname},replace:!0})),!1}};return o.useEffect(()=>{(async()=>{I(!0),await E(),I(!1)})()},[r.pathname]),{isAuthenticated:h,isLoading:m,user:g,checkAuth:E}},he=re`
  0% {
    opacity: 0;
    transform: scale(0.95) translateY(20px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
`;re`
  0% {
    opacity: 0;
    transform: translateY(30px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
`;const Us=re`
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
`,Qs=re`
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
`,je=R.div`
  min-height: 100vh;
  background: linear-gradient(
    135deg,
    hsl(var(--auth-bg-start)) 0%,
    hsl(var(--auth-bg-end)) 100%
  );
  position: relative;
  overflow: hidden;

  /* Background pattern */
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
    pointer-events: none;
  }
`,te=R.div`
  position: absolute;
  top: ${({top:s})=>s||"auto"};
  right: ${({right:s})=>s||"auto"};
  left: ${({left:s})=>s||"auto"};
  bottom: ${({bottom:s})=>s||"auto"};
  width: ${({width:s})=>s};
  height: ${({height:s})=>s};
  background: rgba(255, 255, 255, 0.05);
  border-radius: 50%;
  filter: blur(2rem);
  animation: ${Qs} 6s ease-in-out infinite;
  animation-delay: ${({delay:s})=>s||"0s"};
`;R.div`
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  z-index: 10;
`;R.div`
  text-align: center;
  animation: ${he} 0.6s ease-out;
`;R.div`
  width: 3rem;
  height: 3rem;
  border: 4px solid rgba(255, 255, 255, 0.3);
  border-top: 4px solid white;
  border-radius: 50%;
  animation: ${Us} 1s linear infinite;
  margin: 0 auto 1rem;
`;R.p`
  color: rgba(255, 255, 255, 0.8);
  font-size: 1.125rem;
  font-weight: 500;
`;const Gs=R.div`
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  z-index: 10;
`,Ws=R.div`
  text-align: center;
  max-width: 32rem;
  padding: 2rem;
  animation: ${he} 0.6s ease-out;
`,Ys=R.div`
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(2rem);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 1.5rem;
  padding: 2rem;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
`,Js=R.h1`
  font-size: 2rem;
  font-weight: 700;
  color: #ef4444;
  margin-bottom: 1rem;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
`,Xs=R.p`
  color: rgba(255, 255, 255, 0.8);
  font-size: 1.125rem;
  line-height: 1.6;
  margin-bottom: 1.5rem;
`,ea=R.button`
  padding: 0.75rem 1.5rem;
  background: hsl(var(--auth-button));
  color: white;
  border: none;
  border-radius: 0.75rem;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.1);

  &:hover {
    background: hsl(var(--primary-glow));
    transform: scale(1.05);
    box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.15);
  }
`,sa=R.div`
  min-height: 100vh;
  position: relative;
  z-index: 10;
  animation: ${he} 0.6s ease-out;
`,da=()=>{var r;const{isAuthenticated:s,isLoading:a}=Ks(),{refreshUser:l,user:i}=Ne();return o.useEffect(()=>{i!=null&&i.company||l()},[i==null?void 0:i.company,l]),!a&&!s?e.jsxs(je,{children:[e.jsx(te,{top:"15%",right:"20%",width:"6rem",height:"6rem"}),e.jsx(te,{bottom:"25%",left:"10%",width:"10rem",height:"10rem",delay:"1.5s"}),e.jsx(Gs,{children:e.jsx(Ws,{children:e.jsxs(Ys,{children:[e.jsx(Js,{children:"Acesso não autorizado"}),e.jsx(Xs,{children:"Você precisa estar logado para acessar o catálogo. Faça login para continuar."}),e.jsx(ea,{onClick:()=>window.location.href="/login",children:"Ir para Login"})]})})})]}):e.jsxs(je,{children:[e.jsx(te,{top:"5%",right:"5%",width:"4rem",height:"4rem"}),e.jsx(te,{bottom:"10%",left:"5%",width:"6rem",height:"6rem",delay:"3s"}),e.jsx(sa,{children:e.jsx(Zs,{companyId:(r=i==null?void 0:i.company)==null?void 0:r.id_empresa})})]})};export{da as default};
